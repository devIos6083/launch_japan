# ⏱️ Launch

## 📌 目次  
- [プロジェクト概要](#📌-プロジェクト概要)  
- [進行状況](#📅-進行状況)  
- [実装結果](#🖥-実装結果)  
- [トラブルシューティング](#🛠-トラブルシューティング)  
- [学習内容](#📚-学習内容)  
- [感想](#💬-感想)  

---

## 📌 プロジェクト概要  

| 項目              | 詳細内容 |
|-----------------|--------------------------------------------------------------|
| **貢献度**       | **100% (単独開発)** |
| **プロジェクト目的** | ToDoタイマーアプリ開発による生産性ツールの実装 |
| **実装期間**    | **2025.04.15 ~ 2025.05.18** |
| **技術スタック**    | **Flutter / Dart / Firebase / tts** |
| **核心機能**    | ✅ ToDo入力機能  <br> ✅ 10秒カウントダウンタイマー  <br> ✅ タイマー完了通知  <br> ✅ 履歴保存・閲覧  |

---

## 📅 進行状況  

| 日付          | 作業内容 |
|--------------|-------------------------------------------|
| **2025.04.15** | 📌 **プロジェクト企画・初期設定**  <br> - アプリコンセプト・デザイン構想  <br> - Firebase プロジェクト連携  <br> - 基本UIレイアウト設計 |
| **2025.04.16** | 📌 **核心機能実装**   <br> - ToDo入力フォーム実装  <br> - タイマー機能実装（カウントダウンロジック）  <br> - アニメーション効果追加 |
| **2025.04.17** | 📌 **データ管理実装**   <br> - Firebase Realtime Database連携  <br> - ユーザー別ToDo履歴保存  <br> - データ同期機能実装 |
| **2025.04.18** | 📌 **UI改善・仕上げ**   <br> - 通知機能実装（タイマー完了時）  <br> - UI/UX詳細改善  <br> - パフォーマンス最適化・バグ修正  |
| **2025.04.29** | 📌 **UI改善・コードリファクタリング**   <br> - カカオログイン実装  <br> - データ構造改善  |
| **2025.05.11** | 📌 **タイマーUX改善・バグ修正**   <br> - タイマー色・デザイン改善 <br> - カウントダウン音声機能修正 <br> - タイマー完了後ボタン動作改善 |
| **2025.05.18** | 📌 **統計更新バグ修正**   <br> - 重複統計更新問題解決 <br> - 曜日別進行状況更新修正 <br> - カウントダウン完了後画面遷移ロジック改善 <br> - 不要な手動リフレッシュボタン削除 |

---

## 📌 実装結果

### アプリ主要画面

<table>
<tr>
 <td align="center" width="33%"><strong>スプラッシュ・会員登録画面</strong><br><img src="https://github.com/user-attachments/assets/ea7a579b-95a6-4349-8278-df5915c0c0ad" width="100%"></td>
 <td align="center" width="33%"><strong>パスワードリセット画面</strong><br><img src="https://github.com/user-attachments/assets/8fd071d6-9d2b-4eae-9860-0171bcc6db4c" width="100%"></td>
 <td align="center" width="33%"><strong>ホーム画面・活動追加</strong><br><img src="https://github.com/user-attachments/assets/897d5b87-7de9-4ef9-9d1e-490e9009add0" width="100%"></td>
</tr>
<tr>
 <td align="center" width="33%"><strong>カウントダウン・タイマー画面</strong><br><img src="https://github.com/user-attachments/assets/89f9156b-ad2a-499b-8b30-c0efa9362680" width="100%"></td>
 <td align="center" width="33%"><strong>作業完了・結果分析</strong><br><img src="https://github.com/user-attachments/assets/d08aa950-6309-4661-8385-59ef144e28c5" width="100%"></td>
 <td align="center" width="33%"></td>
</tr>
</table>

---

## 📌 トラブルシューティング

### 🔹 問題1：Firebase権限エラー
- **原因：** Firebase Realtime Databaseセキュリティルール設定問題により`[firebase_database/permission-denied]`エラー発生
- **解決：** データベースルールを修正し、認証されたユーザーが自分のデータのみアクセスできるよう変更。特にデータがない場合（新しい活動作成時）の例外処理追加

### 🔹 問題2：タイマー状態更新エラー
- **原因：** UIレンダリング中に状態更新を試行し、`setState() or markNeedsBuild() called during build`エラー発生
- **解決：** 状態更新ロジックを改善し、ビルド中の場合はフレーム後に状態を更新するよう変更

### 🔹 問題3：カウントダウン音声ガイド重複再生
- **原因：** タイマー更新ごとにTTSが呼び出され、同じ数字が複数回発音される問題
- **解決：** 最後に発話した数字を記録し、新しい数字の時のみTTS実行するよう修正

### 🔹 問題4：アプリ再インストール後の動作問題
- **原因：** ローカルデータ・キャッシュ・認証トークン問題により、アプリ再起動だけでは解決されない問題発生
- **解決：** アプリ削除後再インストールによりすべてのローカルデータとキャッシュを初期化して解決。その後コードで認証・データ初期化ロジック改善

### 🔹 問題5：統計データ重複更新問題
- **原因：** CountdownScreenとFocusTimerScreen両方で統計を更新し、活動完了数が2倍になる問題
- **解決：** FocusTimerScreenの_completeTimerメソッドでのみ統計を更新するようコード修正

### 🔹 問題6：曜日別進行状況更新漏れ
- **原因：** 活動完了時に総活動数は増加するが、weeklyProgressマップの曜日別データが正しく更新されない
- **解決：** 統計更新時に現在の曜日を正確に把握し、weeklyProgressに反映するようロジック改善

### 🔹 問題7：カウントダウン完了前画面遷移バグ
- **原因：** カウントダウンが完了していない状態でフォーカスタイマー画面に遷移する現象
- **解決：** カウントダウン完了条件をより厳密に検査し、遅延を追加して確実に終了後のみ画面遷移するよう修正

---

## 📌 学習内容

### ✅ 1. Firebase Realtime Database データ構造設計
- MySQLデータベースの特性を考慮した効率的なデータ構造設計の重要性学習
- ネスト構造を使用したデータ管理よりフラット構造でデータを設計することが効率的
- ユーザーIDを基準にデータを分離してセキュリティ・アクセス効率性向上

### ✅ 2. Firebaseセキュリティルール設定
- セキュリティルールの重要性と正しい設定方法学習
- ユーザー認証基盤のデータアクセス制御実装
- パス別細分化された権限設定でデータセキュリティ強化
- データ作成・読み取り・修正・削除各作業に適切な権限付与

### ✅ 3. Firebaseデータリアルタイム同期
- Streamを活用したリアルタイムデータ変更検知・UI更新実装
- onValue、onChildAdded、onChildChangedなどのイベントリスナー活用
- データ変更時の効率的なUI更新のための状態管理パターン適用

### ✅ 4. Firebaseトランザクション処理
- 同時性問題解決のためのトランザクション活用方法学習
- カウンター増加などの原子的演算処理
- トランザクションによるデータ一貫性維持

### ✅ 5. Firebase認証管理
- Firebase Authenticationを活用したユーザー認証実装
- 匿名ログイン・トークン管理方法学習
- 認証状態変更検知・適切なUI処理

### ✅ 6. Firebaseオフラインサポート
- オフライン状態でのデータ処理・同期戦略学習
- ローカルキャッシングによるオフラインデータアクセス性向上
- ネットワーク接続復旧時の自動同期実装

### ✅ 7. Flutter状態管理最適化（2024-05-18追加）
- Providerパターンでの重複状態更新防止方法学習
- 単方向データフローを維持して予測可能な状態変化実装
- 画面間データ転送時の適切なタイミングでの状態更新パターン適用

### ✅ 8. UI/UX改善（2024-05-18追加）
- ユーザーエクスペリエンス向上のための不要なUI要素削除（手動リフレッシュボタン）
- タイマー完了時の一貫した動作と視覚的フィードバック提供
- 自動データ同期によるアプリ使いやすさ向上

---

## 📌 感想

Firebase Realtime Databaseを活用してリアルタイムデータ同期の強力さを体験しました。特にStreamベースのデータ検知機能がFlutterの状態管理と自然に連携し、効率的なUI更新が可能でした。

セキュリティルール設定で多くの試行錯誤がありましたが、この過程でデータアクセス制御の重要性とMySQLデータベースの構造設計方式について深く理解できました。最初は単純にデータを保存・取得することだけに集中しましたが、徐々にトランザクション処理、認証管理、オフラインサポートなどのより高度な機能を活用して完成度の高いアプリを開発できました。

また、FlutterのProviderパターンとFirebaseのリアルタイムデータベースを組み合わせて効率的な状態管理アーキテクチャを構築したことが最大の成果だと思います。これによりアプリの複雑性が増加しても拡張性と保守性を維持できるようになりました。

今日（2024-05-18）は特にデータ更新ロジックで発生する複雑なバグを解決しながら、状態管理の重要性を再度実感しました。同じデータを複数箇所で同時に更新することの危険性と、単一責任原則に従ってデータ変更ポイントを明確に定義することがいかに重要かを学びました。このような経験は今後より複雑なアプリを開発する際に大きな助けになるでしょう。

---

## 📌 今後の計画

1. **データ分析機能追加**：ユーザーの活動パターンを分析して生産性インサイト提供
2. **UIテーマ機能**：ダークモード・ユーザーカスタムテーマサポート
3. **プッシュ通知機能強化**：ユーザー活動パターンに合わせたカスタマイズ通知システム開発
4. **Web版開発**：クロスプラットフォームサポートによるアクセシビリティ向上
